<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Goal Achievement Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --book-color: #7209b7;
            --finance-color: #06d6a0;
            --custom-color: #ff9e00;
            --bg-color: #f5f7fb;
            --text-color: #212529;
            --card-bg: white;
            --border-color: #e9ecef;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --border-color: #444444;
            --light: #2d2d2d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-toggle, .export-btn, .import-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-toggle:hover, .export-btn:hover, .import-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-left: 4px solid var(--primary);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #6c757d;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab {
            padding: 12px 25px;
            background-color: var(--card-bg);
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            color: var(--text-color);
        }

        .tab.active {
            background-color: var(--primary);
            color: white;
        }

        .tab:hover:not(.active) {
            background-color: var(--light);
        }

        .goal-category {
            display: none;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
        }

        .goal-category.active {
            display: block;
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
        }

        .book .category-icon {
            background-color: var(--book-color);
        }

        .finance .category-icon {
            background-color: var(--finance-color);
        }

        .custom .category-icon {
            background-color: var(--custom-color);
        }

        .category-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .goal-form {
            background-color: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .priority-badges {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .priority-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .priority-badge.active {
            color: white;
        }

        .priority-high.active {
            background-color: var(--danger);
            border-color: var(--danger);
        }

        .priority-medium.active {
            background-color: var(--warning);
            border-color: var(--warning);
        }

        .priority-low.active {
            background-color: var(--success);
            border-color: var(--success);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
        }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
        }

        .filter-select {
            min-width: 150px;
        }

        .goal-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .goal-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .goal-card:hover {
            transform: translateY(-5px);
        }

        .goal-card.book {
            border-left-color: var(--book-color);
        }

        .goal-card.finance {
            border-left-color: var(--finance-color);
        }

        .goal-card.custom {
            border-left-color: var(--custom-color);
        }

        .goal-card.completed {
            opacity: 0.8;
            position: relative;
        }

        .goal-card.completed::after {
            content: "COMPLETED";
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--success);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .goal-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .goal-priority {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
        }

        .priority-high {
            background-color: var(--danger);
        }

        .priority-medium {
            background-color: var(--warning);
        }

        .priority-low {
            background-color: var(--success);
        }

        .goal-category-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .book .goal-category-badge {
            background-color: var(--book-color);
        }

        .finance .goal-category-badge {
            background-color: var(--finance-color);
        }

        .custom .goal-category-badge {
            background-color: var(--custom-color);
        }

        .goal-description {
            margin-bottom: 15px;
            color: #6c757d;
        }

        .goal-progress {
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 10px;
            background-color: var(--light);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--primary);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .book .progress {
            background-color: var(--book-color);
        }

        .finance .progress {
            background-color: var(--finance-color);
        }

        .custom .progress {
            background-color: var(--custom-color);
        }

        .goal-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .goal-actions {
            display: flex;
            justify-content: space-between;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .rupee-symbol {
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--success);
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0;
            z-index: 999;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .payment-history {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--light);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .payment-history-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .payment-date {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .payment-amount {
            font-weight: 600;
        }

        .add-payment-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .add-payment-form input {
            flex: 1;
        }

        .payment-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            font-weight: 600;
        }

        .import-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .import-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-option:hover {
            background-color: var(--light);
        }

        .import-option i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .file-input {
            display: none;
        }

        .import-preview {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .import-preview.show {
            display: block;
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .preview-item {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-item:last-child {
            border-bottom: none;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .goal-list {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab {
                width: 80%;
                margin-bottom: 10px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header-controls {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            .add-payment-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="export-btn" id="exportBtn" title="Export goals">
                    <i class="fas fa-download"></i>
                </button>
                <button class="import-btn" id="importBtn" title="Import goals">
                    <i class="fas fa-upload"></i>
                </button>
            </div>
            <h1>Enhanced Goal Achievement Tracker</h1>
            <p>Track your progress and achieve your dreams with smart features</p>
        </header>

        <div class="dashboard">
            <div class="stat-card">
                <h3>Total Goals</h3>
                <div class="stat-value" id="totalGoals">0</div>
            </div>
            <div class="stat-card">
                <h3>Completed</h3>
                <div class="stat-value" id="completedGoals">0</div>
            </div>
            <div class="stat-card">
                <h3>In Progress</h3>
                <div class="stat-value" id="inProgressGoals">0</div>
            </div>
            <div class="stat-card">
                <h3>Success Rate</h3>
                <div class="stat-value" id="successRate">0%</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-category="book">Book Reading</button>
            <button class="tab" data-category="finance">Financial Goals</button>
            <button class="tab" data-category="custom">Custom Goals</button>
        </div>

        <!-- Book Reading Goals -->
        <div class="goal-category book active">
            <div class="category-header">
                <div class="category-icon">
                    <i class="fas fa-book"></i>
                </div>
                <h2 class="category-title">Book Reading Goals</h2>
            </div>

            <div class="goal-form">
                <h3>Add New Reading Goal</h3>
                <form id="book-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-title">Book Title</label>
                            <input type="text" id="book-title" class="form-control" placeholder="Enter book title" required>
                        </div>
                        <div class="form-group">
                            <label for="book-author">Author</label>
                            <input type="text" id="book-author" class="form-control" placeholder="Enter author name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-pages">Total Pages</label>
                            <input type="number" id="book-pages" class="form-control" placeholder="Enter total pages" required>
                        </div>
                        <div class="form-group">
                            <label for="book-deadline">Target Completion Date</label>
                            <input type="date" id="book-deadline" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <div class="priority-badges">
                            <div class="priority-badge priority-high" data-priority="high">High</div>
                            <div class="priority-badge priority-medium active" data-priority="medium">Medium</div>
                            <div class="priority-badge priority-low" data-priority="low">Low</div>
                        </div>
                        <input type="hidden" id="book-priority" value="medium">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Reading Goal</button>
                </form>
            </div>

            <div class="search-filter">
                <div class="search-box">
                    <input type="text" id="book-search" class="form-control" placeholder="Search book goals...">
                </div>
                <div class="filter-select">
                    <select id="book-priority-filter" class="form-control">
                        <option value="all">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="filter-select">
                    <select id="book-status-filter" class="form-control">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
            </div>

            <div class="goal-list" id="book-goals">
                <!-- Book goals will be added here dynamically -->
                <div class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <h3>No Reading Goals Yet</h3>
                    <p>Add your first book reading goal to get started!</p>
                </div>
            </div>
        </div>

        <!-- Financial Goals -->
        <div class="goal-category finance">
            <div class="category-header">
                <div class="category-icon">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <h2 class="category-title">Financial Goals</h2>
            </div>

            <div class="goal-form">
                <h3>Add New Financial Goal</h3>
                <form id="finance-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="finance-title">Goal Title</label>
                            <input type="text" id="finance-title" class="form-control" placeholder="E.g., Save for vacation" required>
                        </div>
                        <div class="form-group">
                            <label for="finance-amount">Target Amount (<span class="rupee-symbol">₹</span>)</label>
                            <input type="number" id="finance-amount" class="form-control" placeholder="Enter target amount" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="finance-saved">Amount Saved (<span class="rupee-symbol">₹</span>)</label>
                            <input type="number" id="finance-saved" class="form-control" placeholder="Enter amount saved" required>
                        </div>
                        <div class="form-group">
                            <label for="finance-deadline">Target Date</label>
                            <input type="date" id="finance-deadline" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <div class="priority-badges">
                            <div class="priority-badge priority-high" data-priority="high">High</div>
                            <div class="priority-badge priority-medium active" data-priority="medium">Medium</div>
                            <div class="priority-badge priority-low" data-priority="low">Low</div>
                        </div>
                        <input type="hidden" id="finance-priority" value="medium">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Financial Goal</button>
                </form>
            </div>

            <div class="search-filter">
                <div class="search-box">
                    <input type="text" id="finance-search" class="form-control" placeholder="Search financial goals...">
                </div>
                <div class="filter-select">
                    <select id="finance-priority-filter" class="form-control">
                        <option value="all">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="filter-select">
                    <select id="finance-status-filter" class="form-control">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
            </div>

            <div class="goal-list" id="finance-goals">
                <!-- Financial goals will be added here dynamically -->
                <div class="empty-state">
                    <i class="fas fa-piggy-bank"></i>
                    <h3>No Financial Goals Yet</h3>
                    <p>Add your first financial goal to get started!</p>
                </div>
            </div>
        </div>

        <!-- Custom Goals -->
        <div class="goal-category custom">
            <div class="category-header">
                <div class="category-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
                <h2 class="category-title">Custom Goals</h2>
            </div>

            <div class="goal-form">
                <h3>Add New Custom Goal</h3>
                <form id="custom-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="custom-title">Goal Title</label>
                            <input type="text" id="custom-title" class="form-control" placeholder="Enter goal title" required>
                        </div>
                        <div class="form-group">
                            <label for="custom-target">Target (optional)</label>
                            <input type="text" id="custom-target" class="form-control" placeholder="E.g., Run 5km, Learn Spanish">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="custom-description">Description</label>
                        <textarea id="custom-description" class="form-control" placeholder="Describe your goal"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="custom-progress">Progress (0-100%)</label>
                            <input type="number" id="custom-progress" class="form-control" min="0" max="100" placeholder="Enter progress percentage">
                        </div>
                        <div class="form-group">
                            <label for="custom-deadline">Target Date</label>
                            <input type="date" id="custom-deadline" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <div class="priority-badges">
                            <div class="priority-badge priority-high" data-priority="high">High</div>
                            <div class="priority-badge priority-medium active" data-priority="medium">Medium</div>
                            <div class="priority-badge priority-low" data-priority="low">Low</div>
                        </div>
                        <input type="hidden" id="custom-priority" value="medium">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Custom Goal</button>
                </form>
            </div>

            <div class="search-filter">
                <div class="search-box">
                    <input type="text" id="custom-search" class="form-control" placeholder="Search custom goals...">
                </div>
                <div class="filter-select">
                    <select id="custom-priority-filter" class="form-control">
                        <option value="all">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="filter-select">
                    <select id="custom-status-filter" class="form-control">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
            </div>

            <div class="goal-list" id="custom-goals">
                <!-- Custom goals will be added here dynamically -->
                <div class="empty-state">
                    <i class="fas fa-tasks"></i>
                    <h3>No Custom Goals Yet</h3>
                    <p>Add your first custom goal to get started!</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Enhanced Goal Achievement Tracker &copy; 2023 | Track your progress and achieve your dreams</p>
        </footer>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Import Goals</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="import-options">
                <label class="import-option" for="jsonFileInput">
                    <i class="fas fa-file-code"></i>
                    <div>
                        <h4>Import from JSON file</h4>
                        <p>Upload a previously exported JSON file</p>
                    </div>
                    <input type="file" id="jsonFileInput" class="file-input" accept=".json">
                </label>
                
                <div class="import-option" id="pasteJsonOption">
                    <i class="fas fa-paste"></i>
                    <div>
                        <h4>Paste JSON data</h4>
                        <p>Paste your goals data directly</p>
                    </div>
                </div>
            </div>
            
            <div class="import-preview" id="importPreview">
                <div class="preview-title">Preview (first 5 items):</div>
                <div id="previewContent"></div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-danger" id="cancelImport">Cancel</button>
                <button class="btn btn-primary" id="confirmImport" disabled>Import Goals</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="paymentModalTitle">Add Payment</h3>
                <button class="close-modal" id="closePaymentModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="paymentAmount">Payment Amount (<span class="rupee-symbol">₹</span>)</label>
                <input type="number" id="paymentAmount" class="form-control" placeholder="Enter payment amount" required>
            </div>
            <div class="form-group">
                <label for="paymentDate">Payment Date</label>
                <input type="date" id="paymentDate" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="paymentNote">Note (Optional)</label>
                <input type="text" id="paymentNote" class="form-control" placeholder="Add a note about this payment">
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" id="cancelPayment">Cancel</button>
                <button class="btn btn-primary" id="confirmPayment">Add Payment</button>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal" id="paymentHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="paymentHistoryModalTitle">Payment History</h3>
                <button class="close-modal" id="closePaymentHistoryModal">&times;</button>
            </div>
            <div class="payment-history">
                <div class="payment-history-title">
                    <span>Payment History</span>
                    <button class="btn btn-sm btn-primary" id="addPaymentBtn">Add Payment</button>
                </div>
                <div class="payment-list" id="paymentList">
                    <!-- Payment items will be added here dynamically -->
                </div>
                <div class="payment-summary">
                    <span>Total Paid:</span>
                    <span id="totalPaidAmount">₹0</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" id="closePaymentHistory">Close</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notification-text">Goal completed successfully!</span>
    </div>

    <script>
        // Enhanced Goal Achievement Tracker with Working Import/Export

        // Check for saved theme or use preferred color scheme
        function initTheme() {
            const savedTheme = localStorage.getItem('goalTrackerTheme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                updateThemeIcon(savedTheme);
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
                updateThemeIcon('dark');
            }
        }

        function updateThemeIcon(theme) {
            const icon = document.querySelector('#themeToggle i');
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
        }

        // Format currency in Indian Rupees
        function formatCurrency(amount) {
            return '₹' + amount.toLocaleString('en-IN');
        }

        // Sample data for demonstration
        let goals = {
            book: [],
            finance: [],
            custom: []
        };

        // Payment-related variables
        let currentGoalId = null;
        let currentGoalCategory = null;

        // Import-related variables
        let importData = null;
        let importType = null;

        // Load goals from localStorage
        function loadGoals() {
            const savedGoals = localStorage.getItem('goalTrackerData');
            if (savedGoals) {
                try {
                    goals = JSON.parse(savedGoals);
                    // Ensure all financial goals have payments array
                    goals.finance.forEach(goal => {
                        if (!goal.payments) goal.payments = [];
                    });
                } catch (e) {
                    console.error("Error loading saved goals:", e);
                    initializeSampleData();
                }
            } else {
                initializeSampleData();
            }
        }

        function initializeSampleData() {
            goals.book = [
                {
                    id: 1,
                    title: "Atomic Habits",
                    author: "James Clear",
                    totalPages: 320,
                    currentPage: 150,
                    deadline: "2023-12-31",
                    progress: 47,
                    priority: "high",
                    completed: false
                },
                {
                    id: 2,
                    title: "The Psychology of Money",
                    author: "Morgan Housel",
                    totalPages: 256,
                    currentPage: 256,
                    deadline: "2023-10-15",
                    progress: 100,
                    priority: "medium",
                    completed: true
                }
            ];
            goals.finance = [
                {
                    id: 1,
                    title: "Emergency Fund",
                    targetAmount: 50000,
                    savedAmount: 32000,
                    deadline: "2024-03-01",
                    progress: 64,
                    priority: "high",
                    completed: false,
                    payments: [
                        { date: "2023-01-15", amount: 5000, note: "Initial savings" },
                        { date: "2023-02-20", amount: 7000, note: "Bonus amount" },
                        { date: "2023-03-10", amount: 10000, note: "Tax refund" },
                        { date: "2023-04-05", amount: 10000, note: "Monthly savings" }
                    ]
                },
                {
                    id: 2,
                    title: "New Laptop",
                    targetAmount: 75000,
                    savedAmount: 40000,
                    deadline: "2023-11-30",
                    progress: 53,
                    priority: "medium",
                    completed: false,
                    payments: [
                        { date: "2023-05-01", amount: 15000, note: "First installment" },
                        { date: "2023-06-15", amount: 10000, note: "Second installment" },
                        { date: "2023-07-20", amount: 15000, note: "Third installment" }
                    ]
                }
            ];
            goals.custom = [
                {
                    id: 1,
                    title: "Learn Spanish",
                    description: "Reach conversational level in Spanish",
                    target: "Complete 50 lessons",
                    progress: 30,
                    deadline: "2024-06-01",
                    priority: "medium",
                    completed: false
                },
                {
                    id: 2,
                    title: "Morning Routine",
                    description: "Establish a consistent morning routine",
                    target: "30 days streak",
                    progress: 80,
                    deadline: "2023-11-15",
                    priority: "low",
                    completed: false
                }
            ];
        }

        // Save goals to localStorage
        function saveGoals() {
            localStorage.setItem('goalTrackerData', JSON.stringify(goals));
        }

        // Update dashboard statistics
        function updateDashboard() {
            let totalGoals = 0;
            let completedGoals = 0;
            let inProgressGoals = 0;

            Object.values(goals).forEach(category => {
                category.forEach(goal => {
                    totalGoals++;
                    if (goal.progress === 100) {
                        completedGoals++;
                    } else if (goal.progress > 0) {
                        inProgressGoals++;
                    }
                });
            });

            const successRate = totalGoals > 0 ? Math.round((completedGoals / totalGoals) * 100) : 0;

            document.getElementById('totalGoals').textContent = totalGoals;
            document.getElementById('completedGoals').textContent = completedGoals;
            document.getElementById('inProgressGoals').textContent = inProgressGoals;
            document.getElementById('successRate').textContent = `${successRate}%`;
        }

        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#4361ee', '#3a0ca3', '#4cc9f0', '#f72585', '#f8961e', '#7209b7', '#06d6a0'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                
                // Animate confetti
                const animation = confetti.animate([
                    { top: '-10px', opacity: 1, transform: `rotate(${Math.random() * 360}deg)` },
                    { top: '100vh', opacity: 0, transform: `rotate(${Math.random() * 360}deg)` }
                ], {
                    duration: 1000 + Math.random() * 2000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)'
                });
                
                animation.onfinish = () => {
                    confetti.remove();
                };
            }
        }

        // Format date for display
        function formatDate(dateString) {
            if (!dateString) return 'No deadline';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Calculate days remaining until deadline
        function getDaysRemaining(deadline) {
            if (!deadline) return 'No deadline';
            const today = new Date();
            const targetDate = new Date(deadline);
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? `${diffDays} days left` : 'Deadline passed';
        }

        // Set smart deadline based on category
        function setSmartDeadline(category) {
            const today = new Date();
            const deadline = new Date();
            
            switch(category) {
                case 'book':
                    deadline.setDate(today.getDate() + 30); // 30 days for books
                    break;
                case 'finance':
                    deadline.setMonth(today.getMonth() + 6); // 6 months for finances
                    break;
                default:
                    deadline.setDate(today.getDate() + 90); // 90 days default
            }
            
            return deadline.toISOString().split('T')[0];
        }

        // Filter goals based on search and filter criteria
        function filterGoals(category, searchTerm, priorityFilter, statusFilter) {
            return goals[category].filter(goal => {
                const matchesSearch = goal.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    (goal.author && goal.author.toLowerCase().includes(searchTerm.toLowerCase())) ||
                                    (goal.description && goal.description.toLowerCase().includes(searchTerm.toLowerCase()));
                
                const matchesPriority = priorityFilter === 'all' || goal.priority === priorityFilter;
                
                let matchesStatus = true;
                if (statusFilter === 'completed') {
                    matchesStatus = goal.progress === 100;
                } else if (statusFilter === 'in-progress') {
                    matchesStatus = goal.progress > 0 && goal.progress < 100;
                }
                
                return matchesSearch && matchesPriority && matchesStatus;
            });
        }

        // Update progress for a goal
        function updateProgress(category, id, increment) {
            const goalIndex = goals[category].findIndex(goal => goal.id === id);
            if (goalIndex !== -1) {
                const goal = goals[category][goalIndex];
                let completed = false;
                
                if (category === 'book') {
                    goal.currentPage = Math.min(goal.currentPage + increment, goal.totalPages);
                    goal.progress = Math.round((goal.currentPage / goal.totalPages) * 100);
                    if (goal.progress === 100) completed = true;
                } else if (category === 'finance') {
                    goal.savedAmount = Math.min(goal.savedAmount + increment, goal.targetAmount);
                    goal.progress = Math.round((goal.savedAmount / goal.targetAmount) * 100);
                    if (goal.progress === 100) completed = true;
                } else if (category === 'custom') {
                    goal.progress = Math.min(goal.progress + increment, 100);
                    if (goal.progress === 100) completed = true;
                }
                
                if (completed && !goal.completed) {
                    goal.completed = true;
                    showNotification(`Congratulations! You completed "${goal.title}"`);
                    createConfetti();
                }
                
                saveGoals();
                renderGoals();
                updateDashboard();
            }
        }

        // Add payment to a financial goal
        function addPayment(category, id, amount, date, note = '') {
            const goalIndex = goals[category].findIndex(goal => goal.id === id);
            if (goalIndex !== -1) {
                const goal = goals[category][goalIndex];
                
                // Add the payment
                goal.payments.push({
                    date: date,
                    amount: parseInt(amount),
                    note: note
                });
                
                // Update saved amount and progress
                goal.savedAmount = Math.min(goal.savedAmount + parseInt(amount), goal.targetAmount);
                goal.progress = Math.round((goal.savedAmount / goal.targetAmount) * 100);
                
                // Check if goal is completed
                if (goal.progress === 100 && !goal.completed) {
                    goal.completed = true;
                    showNotification(`Congratulations! You completed "${goal.title}"`);
                    createConfetti();
                }
                
                saveGoals();
                renderGoals();
                updateDashboard();
                
                return true;
            }
            return false;
        }

        // Get total paid amount for a goal
        function getTotalPaid(goal) {
            if (!goal.payments) return 0;
            return goal.payments.reduce((total, payment) => total + payment.amount, 0);
        }

        // Delete a goal
        function deleteGoal(category, id) {
            if (confirm("Are you sure you want to delete this goal?")) {
                goals[category] = goals[category].filter(goal => goal.id !== id);
                saveGoals();
                renderGoals();
                updateDashboard();
                showNotification("Goal deleted successfully");
            }
        }

        // Show payment history for a goal
        function showPaymentHistory(category, id) {
            const goal = goals[category].find(goal => goal.id === id);
            if (goal) {
                currentGoalId = id;
                currentGoalCategory = category;
                
                const modal = document.getElementById('paymentHistoryModal');
                const title = document.getElementById('paymentHistoryModalTitle');
                const paymentList = document.getElementById('paymentList');
                const totalPaid = document.getElementById('totalPaidAmount');
                
                title.textContent = `Payment History - ${goal.title}`;
                
                // Render payment list
                if (goal.payments && goal.payments.length > 0) {
                    paymentList.innerHTML = goal.payments
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .map(payment => `
                            <div class="payment-item">
                                <div>
                                    <div class="payment-date">${formatDate(payment.date)}</div>
                                    <div>${payment.note || 'No note'}</div>
                                </div>
                                <div class="payment-amount">${formatCurrency(payment.amount)}</div>
                            </div>
                        `).join('');
                } else {
                    paymentList.innerHTML = '<div class="payment-item">No payments recorded yet</div>';
                }
                
                // Update total paid
                totalPaid.textContent = formatCurrency(getTotalPaid(goal));
                
                modal.classList.add('show');
            }
        }

        // Show add payment modal
        function showAddPaymentModal() {
            const modal = document.getElementById('paymentModal');
            const goal = goals[currentGoalCategory].find(goal => goal.id === currentGoalId);
            
            if (goal) {
                const title = document.getElementById('paymentModalTitle');
                title.textContent = `Add Payment - ${goal.title}`;
                
                // Set today's date as default
                document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
                
                modal.classList.add('show');
            }
        }

        // Export goals as JSON
        function exportGoals() {
            try {
                const dataStr = JSON.stringify(goals, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                // Create a download link
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `goals-export-${new Date().toISOString().split('T')[0]}.json`;
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up URL
                setTimeout(() => URL.revokeObjectURL(link.href), 100);
                
                showNotification("Goals exported successfully!");
            } catch (error) {
                console.error("Export error:", error);
                showNotification("Error exporting goals: " + error.message);
            }
        }

        // Import goals from JSON
        function importGoals(data, merge = true) {
            try {
                let importedGoals;
                
                if (typeof data === 'string') {
                    importedGoals = JSON.parse(data);
                } else {
                    importedGoals = data;
                }
                
                // Validate the imported data structure
                if (!importedGoals.book || !importedGoals.finance || !importedGoals.custom) {
                    throw new Error("Invalid data format. Expected object with book, finance, and custom arrays.");
                }
                
                if (merge) {
                    // Merge with existing data
                    goals.book = [...goals.book, ...importedGoals.book];
                    goals.finance = [...goals.finance, ...importedGoals.finance];
                    goals.custom = [...goals.custom, ...importedGoals.custom];
                } else {
                    // Replace existing data
                    goals = importedGoals;
                }
                
                // Ensure all goals have unique IDs
                let nextId = Math.max(
                    ...goals.book.map(g => g.id || 0),
                    ...goals.finance.map(g => g.id || 0),
                    ...goals.custom.map(g => g.id || 0),
                    0
                ) + 1;
                
                // Assign new IDs to imported goals without IDs
                goals.book.forEach(goal => {
                    if (!goal.id) goal.id = nextId++;
                });
                goals.finance.forEach(goal => {
                    if (!goal.id) goal.id = nextId++;
                    if (!goal.payments) goal.payments = [];
                });
                goals.custom.forEach(goal => {
                    if (!goal.id) goal.id = nextId++;
                });
                
                saveGoals();
                renderGoals();
                updateDashboard();
                
                const totalImported = importedGoals.book.length + importedGoals.finance.length + importedGoals.custom.length;
                showNotification(`Successfully imported ${totalImported} goals`);
                
                return true;
            } catch (error) {
                console.error("Import error:", error);
                showNotification("Error importing goals: " + error.message);
                return false;
            }
        }

        // Show import preview
        function showImportPreview(data) {
            const preview = document.getElementById('importPreview');
            const previewContent = document.getElementById('previewContent');
            
            let previewHtml = '';
            
            // Show first 5 items from each category
            ['book', 'finance', 'custom'].forEach(category => {
                if (data[category] && data[category].length > 0) {
                    previewHtml += `<div class="preview-title">${category.toUpperCase()} Goals:</div>`;
                    data[category].slice(0, 5).forEach(goal => {
                        previewHtml += `<div class="preview-item">${goal.title} (${goal.progress}%)</div>`;
                    });
                    if (data[category].length > 5) {
                        previewHtml += `<div class="preview-item">... and ${data[category].length - 5} more</div>`;
                    }
                }
            });
            
            previewContent.innerHTML = previewHtml;
            preview.classList.add('show');
            document.getElementById('confirmImport').disabled = false;
        }

        // Handle JSON file import
        function handleJsonFileImport(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    importData = data;
                    importType = 'json';
                    showImportPreview(data);
                } catch (error) {
                    showNotification("Error parsing JSON file: " + error.message);
                }
            };
            reader.onerror = function() {
                showNotification("Error reading file");
            };
            reader.readAsText(file);
        }

        // Function to render goals
        function renderGoals() {
            // Render book goals
            const bookGoalsContainer = document.getElementById('book-goals');
            const bookSearchTerm = document.getElementById('book-search').value;
            const bookPriorityFilter = document.getElementById('book-priority-filter').value;
            const bookStatusFilter = document.getElementById('book-status-filter').value;
            
            const filteredBookGoals = filterGoals('book', bookSearchTerm, bookPriorityFilter, bookStatusFilter);
            
            if (filteredBookGoals.length === 0) {
                bookGoalsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>No Matching Reading Goals</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
            } else {
                bookGoalsContainer.innerHTML = filteredBookGoals.map(goal => `
                    <div class="goal-card book ${goal.progress === 100 ? 'completed' : ''}">
                        <div class="goal-header">
                            <div>
                                <h3 class="goal-title">${goal.title}</h3>
                                <p>by ${goal.author}</p>
                                <span class="goal-priority priority-${goal.priority}">${goal.priority.toUpperCase()}</span>
                            </div>
                            <span class="goal-category-badge">Reading</span>
                        </div>
                        <p class="goal-description">${goal.totalPages} pages total</p>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress" style="width: ${goal.progress}%"></div>
                            </div>
                        </div>
                        <div class="goal-details">
                            <span>Page ${goal.currentPage} of ${goal.totalPages}</span>
                            <span>${goal.progress}%</span>
                        </div>
                        <div class="goal-details">
                            <span>Target: ${formatDate(goal.deadline)}</span>
                            <span>${getDaysRemaining(goal.deadline)}</span>
                        </div>
                        <div class="goal-actions">
                            <button class="btn btn-success btn-sm" onclick="updateProgress('book', ${goal.id}, 10)">+10 Pages</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGoal('book', ${goal.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }

            // Render finance goals
            const financeGoalsContainer = document.getElementById('finance-goals');
            const financeSearchTerm = document.getElementById('finance-search').value;
            const financePriorityFilter = document.getElementById('finance-priority-filter').value;
            const financeStatusFilter = document.getElementById('finance-status-filter').value;
            
            const filteredFinanceGoals = filterGoals('finance', financeSearchTerm, financePriorityFilter, financeStatusFilter);
            
            if (filteredFinanceGoals.length === 0) {
                financeGoalsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-piggy-bank"></i>
                        <h3>No Matching Financial Goals</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
            } else {
                financeGoalsContainer.innerHTML = filteredFinanceGoals.map(goal => `
                    <div class="goal-card finance ${goal.progress === 100 ? 'completed' : ''}">
                        <div class="goal-header">
                            <div>
                                <h3 class="goal-title">${goal.title}</h3>
                                <span class="goal-priority priority-${goal.priority}">${goal.priority.toUpperCase()}</span>
                            </div>
                            <span class="goal-category-badge">Finance</span>
                        </div>
                        <p class="goal-description">Target: ${formatCurrency(goal.targetAmount)}</p>
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress" style="width: ${goal.progress}%"></div>
                            </div>
                        </div>
                        <div class="goal-details">
                            <span>Saved: ${formatCurrency(goal.savedAmount)}</span>
                            <span>${goal.progress}%</span>
                        </div>
                        <div class="goal-details">
                            <span>Target: ${formatDate(goal.deadline)}</span>
                            <span>${getDaysRemaining(goal.deadline)}</span>
                        </div>
                        <div class="payment-history">
                            <div class="payment-history-title">
                                <span>Payment History</span>
                                <button class="btn btn-sm btn-primary" onclick="showPaymentHistory('finance', ${goal.id})">View Payments</button>
                            </div>
                            <div class="payment-summary">
                                <span>Total Paid:</span>
                                <span>${formatCurrency(getTotalPaid(goal))}</span>
                            </div>
                        </div>
                        <div class="goal-actions">
                            <button class="btn btn-success btn-sm" onclick="updateProgress('finance', ${goal.id}, 1000)">+₹1,000</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGoal('finance', ${goal.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }

            // Render custom goals
            const customGoalsContainer = document.getElementById('custom-goals');
            const customSearchTerm = document.getElementById('custom-search').value;
            const customPriorityFilter = document.getElementById('custom-priority-filter').value;
            const customStatusFilter = document.getElementById('custom-status-filter').value;
            
            const filteredCustomGoals = filterGoals('custom', customSearchTerm, customPriorityFilter, customStatusFilter);
            
            if (filteredCustomGoals.length === 0) {
                customGoalsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <h3>No Matching Custom Goals</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
            } else {
                customGoalsContainer.innerHTML = filteredCustomGoals.map(goal => `
                    <div class="goal-card custom ${goal.progress === 100 ? 'completed' : ''}">
                        <div class="goal-header">
                            <div>
                                <h3 class="goal-title">${goal.title}</h3>
                                <p>${goal.description}</p>
                                <span class="goal-priority priority-${goal.priority}">${goal.priority.toUpperCase()}</span>
                            </div>
                            <span class="goal-category-badge">Custom</span>
                        </div>
                        ${goal.target ? `<p class="goal-description">Target: ${goal.target}</p>` : ''}
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress" style="width: ${goal.progress}%"></div>
                            </div>
                        </div>
                        <div class="goal-details">
                            <span>Progress</span>
                            <span>${goal.progress}%</span>
                        </div>
                        ${goal.deadline ? `
                        <div class="goal-details">
                            <span>Target: ${formatDate(goal.deadline)}</span>
                            <span>${getDaysRemaining(goal.deadline)}</span>
                        </div>
                        ` : ''}
                        <div class="goal-actions">
                            <button class="btn btn-success btn-sm" onclick="updateProgress('custom', ${goal.id}, 10)">+10%</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteGoal('custom', ${goal.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Form submission handlers
        document.getElementById('book-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('book-title').value;
            const author = document.getElementById('book-author').value;
            const totalPages = parseInt(document.getElementById('book-pages').value);
            const deadline = document.getElementById('book-deadline').value || setSmartDeadline('book');
            const priority = document.getElementById('book-priority').value;
            
            const newGoal = {
                id: Date.now(),
                title,
                author,
                totalPages,
                currentPage: 0,
                deadline,
                progress: 0,
                priority,
                completed: false
            };
            
            goals.book.push(newGoal);
            saveGoals();
            renderGoals();
            updateDashboard();
            this.reset();
            document.getElementById('book-deadline').value = setSmartDeadline('book');
            showNotification("Reading goal added successfully");
        });

        document.getElementById('finance-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('finance-title').value;
            const targetAmount = parseInt(document.getElementById('finance-amount').value);
            const savedAmount = parseInt(document.getElementById('finance-saved').value);
            const deadline = document.getElementById('finance-deadline').value || setSmartDeadline('finance');
            const priority = document.getElementById('finance-priority').value;
            
            const newGoal = {
                id: Date.now(),
                title,
                targetAmount,
                savedAmount,
                deadline,
                progress: Math.round((savedAmount / targetAmount) * 100),
                priority,
                completed: false,
                payments: []
            };
            
            goals.finance.push(newGoal);
            saveGoals();
            renderGoals();
            updateDashboard();
            this.reset();
            document.getElementById('finance-deadline').value = setSmartDeadline('finance');
            showNotification("Financial goal added successfully");
        });

        document.getElementById('custom-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('custom-title').value;
            const description = document.getElementById('custom-description').value;
            const target = document.getElementById('custom-target').value;
            const progress = parseInt(document.getElementById('custom-progress').value) || 0;
            const deadline = document.getElementById('custom-deadline').value || setSmartDeadline('custom');
            const priority = document.getElementById('custom-priority').value;
            
            const newGoal = {
                id: Date.now(),
                title,
                description,
                target,
                progress,
                deadline,
                priority,
                completed: false
            };
            
            goals.custom.push(newGoal);
            saveGoals();
            renderGoals();
            updateDashboard();
            this.reset();
            document.getElementById('custom-deadline').value = setSmartDeadline('custom');
            showNotification("Custom goal added successfully");
        });

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme
            initTheme();
            
            // Load goals from storage
            loadGoals();
            
            // Set default deadlines in forms
            document.getElementById('book-deadline').value = setSmartDeadline('book');
            document.getElementById('finance-deadline').value = setSmartDeadline('finance');
            document.getElementById('custom-deadline').value = setSmartDeadline('custom');
            
            // Render initial goals and dashboard
            renderGoals();
            updateDashboard();
            
            // Set up priority badge selection
            document.querySelectorAll('.priority-badge').forEach(badge => {
                badge.addEventListener('click', function() {
                    const parent = this.closest('.form-group');
                    const hiddenInput = parent.querySelector('input[type="hidden"]');
                    
                    // Remove active class from all badges in this group
                    parent.querySelectorAll('.priority-badge').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Add active class to clicked badge
                    this.classList.add('active');
                    
                    // Update hidden input value
                    hiddenInput.value = this.getAttribute('data-priority');
                });
            });
            
            // Set up search and filter event listeners
            document.getElementById('book-search').addEventListener('input', renderGoals);
            document.getElementById('book-priority-filter').addEventListener('change', renderGoals);
            document.getElementById('book-status-filter').addEventListener('change', renderGoals);
            
            document.getElementById('finance-search').addEventListener('input', renderGoals);
            document.getElementById('finance-priority-filter').addEventListener('change', renderGoals);
            document.getElementById('finance-status-filter').addEventListener('change', renderGoals);
            
            document.getElementById('custom-search').addEventListener('input', renderGoals);
            document.getElementById('custom-priority-filter').addEventListener('change', renderGoals);
            document.getElementById('custom-status-filter').addEventListener('change', renderGoals);
            
            // Set up theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('goalTrackerTheme', newTheme);
                updateThemeIcon(newTheme);
            });
            
            // Set up export button
            document.getElementById('exportBtn').addEventListener('click', exportGoals);
            
            // Import modal functionality
            const importModal = document.getElementById('importModal');
            const importBtn = document.getElementById('importBtn');
            const closeModal = document.getElementById('closeModal');
            const cancelImport = document.getElementById('cancelImport');
            const confirmImport = document.getElementById('confirmImport');
            const jsonFileInput = document.getElementById('jsonFileInput');
            const pasteJsonOption = document.getElementById('pasteJsonOption');
            
            // Open import modal
            importBtn.addEventListener('click', function() {
                importModal.classList.add('show');
                // Reset import state
                importData = null;
                importType = null;
                document.getElementById('importPreview').classList.remove('show');
                document.getElementById('confirmImport').disabled = true;
                jsonFileInput.value = '';
            });
            
            // Close import modal
            closeModal.addEventListener('click', function() {
                importModal.classList.remove('show');
            });
            
            cancelImport.addEventListener('click', function() {
                importModal.classList.remove('show');
            });
            
            // Handle file imports
            jsonFileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleJsonFileImport(e.target.files[0]);
                }
            });
            
            // Handle paste JSON option
            pasteJsonOption.addEventListener('click', function() {
                const jsonData = prompt("Paste your JSON data here:");
                if (jsonData) {
                    try {
                        const data = JSON.parse(jsonData);
                        importData = data;
                        importType = 'json';
                        showImportPreview(data);
                    } catch (error) {
                        showNotification("Error parsing JSON: " + error.message);
                    }
                }
            });
            
            // Confirm import
            confirmImport.addEventListener('click', function() {
                if (importData && importType) {
                    const merge = confirm("Do you want to merge with existing goals? Click OK to merge, Cancel to replace.");
                    importGoals(importData, merge);
                    importModal.classList.remove('show');
                }
            });
            
            // Payment modal functionality
            const paymentModal = document.getElementById('paymentModal');
            const closePaymentModal = document.getElementById('closePaymentModal');
            const cancelPayment = document.getElementById('cancelPayment');
            const confirmPayment = document.getElementById('confirmPayment');
            
            // Payment history modal functionality
            const paymentHistoryModal = document.getElementById('paymentHistoryModal');
            const closePaymentHistoryModal = document.getElementById('closePaymentHistoryModal');
            const closePaymentHistory = document.getElementById('closePaymentHistory');
            const addPaymentBtn = document.getElementById('addPaymentBtn');
            
            // Close payment modal
            closePaymentModal.addEventListener('click', function() {
                paymentModal.classList.remove('show');
            });
            
            cancelPayment.addEventListener('click', function() {
                paymentModal.classList.remove('show');
            });
            
            // Close payment history modal
            closePaymentHistoryModal.addEventListener('click', function() {
                paymentHistoryModal.classList.remove('show');
            });
            
            closePaymentHistory.addEventListener('click', function() {
                paymentHistoryModal.classList.remove('show');
            });
            
            // Add payment button in payment history modal
            addPaymentBtn.addEventListener('click', function() {
                paymentHistoryModal.classList.remove('show');
                showAddPaymentModal();
            });
            
            // Confirm payment
            confirmPayment.addEventListener('click', function() {
                const amount = document.getElementById('paymentAmount').value;
                const date = document.getElementById('paymentDate').value;
                const note = document.getElementById('paymentNote').value;
                
                if (!amount || !date) {
                    showNotification("Please fill in all required fields");
                    return;
                }
                
                if (addPayment(currentGoalCategory, currentGoalId, amount, date, note)) {
                    paymentModal.classList.remove('show');
                    showNotification("Payment added successfully");
                    
                    // Reopen payment history modal to show updated list
                    showPaymentHistory(currentGoalCategory, currentGoalId);
                } else {
                    showNotification("Error adding payment");
                }
            });
            
            // Tab switching functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and categories
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.goal-category').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding category
                    tab.classList.add('active');
                    const category = tab.getAttribute('data-category');
                    document.querySelector(`.goal-category.${category}`).classList.add('active');
                });
            });
        });
    </script>
</body>
</html>